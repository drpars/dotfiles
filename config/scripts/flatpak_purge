#!/bin/bash
# Flatpak Temizleme BetiÄŸi: TÃ¼m uygulama, veri ve kalÄ±ntÄ±larÄ± kaldÄ±rÄ±r.

echo "================================================"
echo "âš ï¸ UYARI: BU Ä°ÅLEM GERÄ° ALINAMAZ!"
echo "   Flatpak ile kurulu TÃœM uygulamalar ve kaydettikleri"
echo "   TÃœM kullanÄ±cÄ± verileri silinecektir."
echo "================================================"

# KullanÄ±cÄ±dan onay isteme (Zsh ile uyumlu ayrÄ±lmÄ±ÅŸ prompt)
echo -n "TÃ¼m Flatpak uygulamalarÄ±nÄ± ve verilerini silmek istediÄŸinizden emin misiniz? (E/h): "
read -r confirmation

if [[ "$confirmation" =~ ^[EeYy]$ ]]; then

    # --- 1. TÃœM UYGULAMALARI VE VERÄ°LERÄ°NÄ° KALDIRMA ---
    echo ""
    echo ">>> AdÄ±m 1/3: Kurulu TÃœM uygulamalar ve verileri kaldÄ±rÄ±lÄ±yor (Otomatik Onay)..."
    
    # -y (veya --noninteractive): Onay sormadan iÅŸlemi otomatik olarak 'Evet' ile devam ettirir.
    flatpak uninstall --all --delete-data -y 

    if [ $? -eq 0 ]; then
        echo "âœ… TÃ¼m uygulamalar ve verileri baÅŸarÄ±yla kaldÄ±rÄ±ldÄ±."
    else
        echo "âŒ Uygulama kaldÄ±rma iÅŸleminde hata oluÅŸtu. Devam ediliyor..."
    fi

    # --- 2. KULLANILMAYAN Ã‡ALIÅMA ZAMANLARINI (RUNTIME) TEMÄ°ZLEME ---
    echo ""
    echo ">>> AdÄ±m 2/3: KullanÄ±lmayan Ã§alÄ±ÅŸma zamanlarÄ± (runtime) ve baÄŸÄ±mlÄ±lÄ±klar temizleniyor..."
    
    # KullanÄ±lmayan kÃ¼tÃ¼phaneleri otomatik olarak kaldÄ±rÄ±r.
    flatpak uninstall --unused -y
    echo "âœ… KullanÄ±lmayan Ã§alÄ±ÅŸma zamanlarÄ± temizlendi."

    # --- 3. KULLANICI AYARLARI VE Ã–N BELLEÄÄ°NÄ° SIFIRLAMA ---
    echo ""
    echo ">>> AdÄ±m 3/3: Flatpak kullanÄ±cÄ± geÃ§ersiz kÄ±lmalarÄ± (override) ve Ã¶nbellek temizleniyor..."

    # a) Global ve Uygulama Override'larÄ±nÄ± (Ä°zinler, Tema ZorlamalarÄ±) SÄ±fÄ±rlama
    flatpak override --user --reset
    
    # b) KullanÄ±cÄ± Ã–n BelleÄŸini Silme
    rm -rf ~/.cache/flatpak
    echo "âœ… TÃ¼m geÃ§ersiz kÄ±lmalar ve Ã¶nbellek temizlendi."
    
    echo ""
    echo "ğŸ‰ Flatpak sistemi ve tÃ¼m kalÄ±ntÄ±larÄ± baÅŸarÄ±yla temizlendi."

else
    echo ""
    echo "Ä°ÅŸlem iptal edildi. Flatpak uygulamalarÄ± ve verileri korunuyor."
fi
